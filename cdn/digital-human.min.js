!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three"),require("three/addons/loaders/GLTFLoader.js"),require("three/addons/controls/OrbitControls.js")):"function"==typeof define&&define.amd?define(["exports","three","three/addons/loaders/GLTFLoader.js","three/addons/controls/OrbitControls.js"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).DigitalHuman={},e.THREE,e.THREE,e.THREE)}(this,function(e,t,i,n){"use strict";function s(e){var t=Object.create(null);return e&&Object.keys(e).forEach(function(i){if("default"!==i){var n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:function(){return e[i]}})}}),t.default=e,Object.freeze(t)}var o=s(t);const a={CDN_BASE:"https://cdn.jsdelivr.net/gh/zizaijiyihu/digital-human-component@latest/cdn",DEFAULT_ANIMATIONS:{idle:"https://cdn.jsdelivr.net/gh/zizaijiyihu/digital-human-component@latest/cdn/animations/F_Standing_Idle_001.glb",talking:"https://cdn.jsdelivr.net/gh/zizaijiyihu/digital-human-component@latest/cdn/animations/F_Talking_Variations_005.glb"},PHONEME_TO_VISEME:{aa:"viseme_aa",E:"viseme_E",I:"viseme_I",O:"viseme_O",U:"viseme_U",PP:"viseme_PP",FF:"viseme_FF",TH:"viseme_TH",DD:"viseme_DD",kk:"viseme_kk",CH:"viseme_CH",SS:"viseme_SS",nn:"viseme_nn",RR:"viseme_RR",sil:"viseme_sil"},CAMERA:{fov:45,aspect:1,near:.1,far:1e3,position:{x:0,y:1.6,z:.7},target:{x:0,y:1.5,z:0}},LIGHTS:{ambient:{color:16777215,intensity:.7},key:{color:16777215,intensity:.8,position:{x:0,y:2,z:1}},fill:{color:16777215,intensity:.4,position:{x:0,y:1.6,z:.8}},rim:{color:11193599,intensity:.3,position:{x:0,y:1.8,z:-.5}}},EXPRESSIONS:{blink:{duration:80,intensity:1},smile:{fadeIn:500,hold:{min:3e3,max:5e3},fadeOut:800,intensity:.35},nod:{duration:300,intensity:.1},browRaise:{duration:200,hold:400,intensity:.3},headTilt:{duration:600,hold:1500,intensity:.08}},EXPRESSION_FREQUENCY:{blink:{min:2e3,max:5e3},smile:{min:8e3,max:15e3},nod:{min:1e4,max:2e4},browRaise:{min:6e3,max:12e3},headTilt:{min:15e3,max:25e3}},LIP_SYNC:{fftSize:512,speechRate:3.5,syllableDuration:286,closeRatio:.2,decayRate:{normal:.85,silence:.5,closing:.3}}};class r{constructor(e,t={}){this.container=e,this.config=t,this.scene=null,this.camera=null,this.renderer=null,this.controls=null,this.mixer=null,this.clock=null,this.backgroundTexture=null,this.animationId=null,this._init()}_init(){this.scene=new o.Scene,this.scene.background=new o.Color(this.config.backgroundColor||"#1a1a2e");const e=this.config.width||600,t=this.config.height||600;this.camera=new o.PerspectiveCamera(a.CAMERA.fov,e/t,a.CAMERA.near,a.CAMERA.far);const i=this.config.cameraPosition||a.CAMERA.position;if(this.camera.position.set(i.x,i.y,i.z),this.renderer=new o.WebGLRenderer({antialias:!0}),this.renderer.setSize(e,t),this.renderer.shadowMap.enabled=!0,this.container.appendChild(this.renderer.domElement),!1!==this.config.enableOrbitControls){this.controls=new n.OrbitControls(this.camera,this.renderer.domElement);const e=this.config.cameraTarget||a.CAMERA.target;this.controls.target.set(e.x,e.y,e.z),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.minDistance=.5,this.controls.maxDistance=1.5,this.controls.update()}this._setupLights(),this.clock=new o.Clock,this._startRenderLoop(),window.addEventListener("resize",()=>this._onWindowResize())}_setupLights(){const e=a.LIGHTS,t=new o.AmbientLight(e.ambient.color,e.ambient.intensity);this.scene.add(t);const i=new o.DirectionalLight(e.key.color,e.key.intensity);i.position.set(e.key.position.x,e.key.position.y,e.key.position.z),this.scene.add(i);const n=new o.DirectionalLight(e.fill.color,e.fill.intensity);n.position.set(e.fill.position.x,e.fill.position.y,e.fill.position.z),this.scene.add(n);const s=new o.DirectionalLight(e.rim.color,e.rim.intensity);s.position.set(e.rim.position.x,e.rim.position.y,e.rim.position.z),this.scene.add(s)}_startRenderLoop(){const e=()=>{this.animationId=requestAnimationFrame(e);const t=this.clock.getDelta();this.mixer&&this.mixer.update(t),this.controls&&this.controls.update(),this.renderer.render(this.scene,this.camera)};e()}_onWindowResize(){const e=this.container.clientWidth,t=this.container.clientHeight;this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}setBackgroundColor(e){this.scene.background=new o.Color(e)}async setBackgroundImage(e){return new Promise((t,i)=>{(new o.TextureLoader).load(e,e=>{this.backgroundTexture&&this.backgroundTexture.dispose();const i=e.image.width/e.image.height;if(i>1){const t=1/i;e.repeat.set(t,1),e.offset.set((1-t)/2,0)}else{const t=i/1;e.repeat.set(1,t),e.offset.set(0,(1-t)/2)}this.scene.background=e,this.backgroundTexture=e,t()},void 0,i)})}clearBackgroundImage(){this.backgroundTexture&&(this.backgroundTexture.dispose(),this.backgroundTexture=null),this.scene.background=new o.Color(this.config.backgroundColor||"#1a1a2e")}destroy(){this.animationId&&cancelAnimationFrame(this.animationId),this.backgroundTexture&&this.backgroundTexture.dispose(),this.renderer&&(this.renderer.dispose(),this.renderer.domElement.parentNode&&this.renderer.domElement.parentNode.removeChild(this.renderer.domElement)),this.controls&&this.controls.dispose(),window.removeEventListener("resize",this._onWindowResize)}}class h{constructor(e,t){this.avatar=e,this.mixer=t||new o.AnimationMixer(e),this.animations=new Map,this.currentAction=null,this.loader=new i.GLTFLoader}async loadAnimation(e,t){return console.log(`üì• Loading animation "${e}" from:`,t),new Promise((i,n)=>{this.loader.load(t,s=>{if(s.animations&&s.animations.length>0){const t=s.animations[0],n=this.mixer.clipAction(t);n.setLoop(o.LoopRepeat),this.animations.set(e,{clip:t,action:n}),console.log(`‚úÖ Animation "${e}" loaded successfully (duration: ${t.duration.toFixed(2)}s)`),i({name:e,clip:t,action:n})}else n(new Error(`No animations found in ${t}`))},t=>{const i=(t.loaded/t.total*100).toFixed(0);console.log(`‚è≥ Loading "${e}": ${i}%`)},t=>{console.error(`‚ùå Failed to load animation "${e}":`,t),n(t)})})}play(e,t=.3){const i=this.animations.get(e);if(!i)return console.warn(`‚ùå Animation "${e}" not loaded`),void console.log("Available animations:",Array.from(this.animations.keys()));const{action:n}=i;this.currentAction&&this.currentAction!==n&&(console.log("‚è∏Ô∏è Fading out previous animation"),this.currentAction.fadeOut(t)),n.reset(),n.fadeIn(t),n.play(),this.currentAction=n,console.log(`‚ñ∂Ô∏è Playing animation "${e}" (weight: ${n.getEffectiveWeight()})`)}stop(e=null,t=.3){if(e){const i=this.animations.get(e);i&&i.action.fadeOut(t)}else this.currentAction&&(this.currentAction.fadeOut(t),this.currentAction=null)}stopAll(){this.animations.forEach(({action:e})=>{e.stop()}),this.currentAction=null}destroy(){this.stopAll(),this.animations.clear()}}class l{constructor(e){if(!e)throw new Error("LipSyncEngine: morphTargetMesh is required");this.morphTargetMesh=e,this.morphTargetDict=e.morphTargetDictionary,this.audioContext=null,this.analyser=null,this.audioSource=null,this.isActive=!1,this.isClosing=!1,this.animationId=null,this.currentPhoneme="sil",this.currentViseme="viseme_sil",this.lastPhonemeTime=0,this.config=a.LIP_SYNC,this.phonemeMap=a.PHONEME_TO_VISEME}start(e){if(this.morphTargetMesh){this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.config.fftSize,this.analyser.connect(this.audioContext.destination)),"suspended"===this.audioContext.state&&this.audioContext.resume(),this.audioSource&&this.audioSource.disconnect();try{this.audioSource=this.audioContext.createMediaElementSource(e),this.audioSource.connect(this.analyser)}catch(e){return void console.error("Failed to create audio source:",e)}this.isActive=!0,this.isClosing=!1,this.currentPhoneme="sil",this.currentViseme="viseme_sil",this.lastPhonemeTime=Date.now(),this._update(e)}else console.error("‚ùå morphTargetMesh not initialized")}stop(){(this.isActive||this.isClosing)&&(this.isActive=!1,this.isClosing=!0)}_update(e){if(!this.isActive&&!this.isClosing)return;if(this.isClosing){let t=!0;Object.values(this.phonemeMap).forEach(e=>{const i=this.morphTargetDict[e];if(void 0!==i){const e=this.morphTargetMesh.morphTargetInfluences[i]||0;e>.001?(this.morphTargetMesh.morphTargetInfluences[i]=e*this.config.decayRate.closing,t=!1):this.morphTargetMesh.morphTargetInfluences[i]=0}});const i=this.morphTargetDict.jawOpen;if(void 0!==i){const e=this.morphTargetMesh.morphTargetInfluences[i]||0;e>.001?(this.morphTargetMesh.morphTargetInfluences[i]=e*this.config.decayRate.closing,t=!1):this.morphTargetMesh.morphTargetInfluences[i]=0}return t?void(this.isClosing=!1):void requestAnimationFrame(()=>this._update(e))}if(e.ended||e.currentTime>=e.duration-.05)return this.isActive=!1,this.isClosing=!0,void requestAnimationFrame(()=>this._update(e));requestAnimationFrame(()=>this._update(e));const t=new Uint8Array(this.analyser.frequencyBinCount);this.analyser.getByteFrequencyData(t);let i=0,n=0,s=0,o=0,a=0;for(let e=0;e<15;e++)i+=t[e];for(let e=15;e<35;e++)n+=t[e];for(let e=35;e<70;e++)s+=t[e];for(let e=70;e<120;e++)o+=t[e];for(let e=120;e<180;e++)a+=t[e];i/=3825,n/=5100,s/=8925,o/=12750,a/=15300;const r=(i+n+s+o+a)/5;let h="sil",l="viseme_sil";1e3*e.currentTime%this.config.syllableDuration/this.config.syllableDuration>1-this.config.closeRatio||r<.05?(h="sil",l="viseme_sil"):o>.25&&o/(n+i+.001)>1.5?(h="SS",l="viseme_SS"):a>.2?(h="kk",l="viseme_kk"):s>.25&&o>.15?(h="CH",l="viseme_SS"):s>.3?(h="DD",l="viseme_DD"):i>n&&i>.2?(h=i>.35?"aa":"O",l="aa"===h?"viseme_aa":"viseme_O"):n>.2?(h=n>1.3*s?"E":"I",l="E"===h?"viseme_E":"viseme_I"):(h="aa",l="viseme_aa");const c=Date.now();h!==this.currentPhoneme&&c-this.lastPhonemeTime>80&&(this.currentPhoneme=h,this.currentViseme=l,this.lastPhonemeTime=c);const d=this.morphTargetDict[this.currentViseme];if(void 0!==d){const e=this.morphTargetMesh.morphTargetInfluences[d]||0,t=Math.min(1.2*r,.7);this.morphTargetMesh.morphTargetInfluences[d]=.7*e+.3*t}const u="sil"===this.currentPhoneme?this.config.decayRate.silence:this.config.decayRate.normal;Object.values(this.phonemeMap).forEach(e=>{if(e!==this.currentViseme){const t=this.morphTargetDict[e];void 0!==t&&(this.morphTargetMesh.morphTargetInfluences[t]*=u)}});const g=this.morphTargetDict.jawOpen;if(void 0!==g)if("sil"===this.currentPhoneme){const e=this.morphTargetMesh.morphTargetInfluences[g]||0;this.morphTargetMesh.morphTargetInfluences[g]=.4*e}else{let e=0;["aa","E","O","I","U"].includes(this.currentPhoneme)?e=.5*r:["DD","nn","CH","SS"].includes(this.currentPhoneme)&&(e=.2*r);const t=this.morphTargetMesh.morphTargetInfluences[g]||0;this.morphTargetMesh.morphTargetInfluences[g]=.7*t+.3*e}}destroy(){this.stop(),this.audioSource&&(this.audioSource.disconnect(),this.audioSource=null),this.audioContext&&(this.audioContext.close(),this.audioContext=null)}}class c{constructor(e,t,i,n={}){this.morphTargetMesh=e,this.morphTargetDict=e?e.morphTargetDictionary:{},this.headBone=t,this.neckBone=i,this.config=n,this.mode=null,this.intervals=[]}startListeningMode(){this.stopAll(),this.mode="listening";const e=this.config.expressionFrequency||a.EXPRESSION_FREQUENCY;!1!==this.config.enableBlinking&&this._scheduleExpression("blink",e.blink.min,e.blink.max),!1!==this.config.enableSmiling&&this._scheduleExpression("smile",e.smile.min,e.smile.max),!1!==this.config.enableNodding&&this._scheduleExpression("nod",e.nod.min,e.nod.max),!1!==this.config.enableBrowRaising&&this._scheduleExpression("raiseBrows",e.browRaise.min,e.browRaise.max),!1!==this.config.enableHeadTilting&&this._scheduleExpression("tiltHead",e.headTilt.min,e.headTilt.max)}stopListeningMode(){"listening"===this.mode&&this.stopAll()}startSpeakingMode(){if(this.stopAll(),this.mode="speaking",!1!==this.config.enableBlinking){const e=this.config.expressionFrequency||a.EXPRESSION_FREQUENCY;this._scheduleExpression("blink",e.blink.min+500,e.blink.max+500)}}stopSpeakingMode(){"speaking"===this.mode&&this.stopAll()}stopAll(){this.intervals.forEach(e=>clearInterval(e)),this.intervals=[],this.mode=null}_scheduleExpression(e,t,i){const n=()=>{this[e]&&this[e]();const s=Math.random()*(i-t)+t,o=setTimeout(n,s);this.intervals.push(o)},s=Math.random()*(i-t)+t,o=setTimeout(n,s);this.intervals.push(o)}blink(){if(!this.morphTargetMesh)return;const e=this.morphTargetDict,t=this.morphTargetMesh.morphTargetInfluences,i=e.eyeBlinkLeft,n=e.eyeBlinkRight;if(void 0===i||void 0===n)return;const s=a.EXPRESSIONS.blink,o=s.duration;this._tween({value:0},{value:s.intensity},o,e=>{t[i]=e.value,t[n]=e.value},()=>{this._tween({value:s.intensity},{value:0},o,e=>{t[i]=e.value,t[n]=e.value})})}smile(){if(!this.morphTargetMesh)return;const e=this.morphTargetDict,t=this.morphTargetMesh.morphTargetInfluences,i=e.mouthSmileLeft,n=e.mouthSmileRight;if(void 0===i||void 0===n)return;const s=a.EXPRESSIONS.smile;this._tween({value:0},{value:s.intensity},s.fadeIn,e=>{t[i]=e.value,t[n]=e.value},()=>{const e=Math.random()*(s.hold.max-s.hold.min)+s.hold.min;setTimeout(()=>{this._tween({value:s.intensity},{value:0},s.fadeOut,e=>{t[i]=e.value,t[n]=e.value})},e)})}nod(){if(!this.headBone)return;const e=this.headBone.rotation.x,t=a.EXPRESSIONS.nod;this._tween({x:e},{x:e+t.intensity},t.duration,e=>{this.headBone.rotation.x=e.x},()=>{this._tween({x:e+t.intensity},{x:e},t.duration,e=>{this.headBone.rotation.x=e.x})})}raiseBrows(){if(!this.morphTargetMesh)return;const e=this.morphTargetDict,t=this.morphTargetMesh.morphTargetInfluences,i=e.browInnerUp;if(void 0===i)return;const n=a.EXPRESSIONS.browRaise;this._tween({value:0},{value:n.intensity},n.duration,e=>{t[i]=e.value},()=>{this._tween({value:n.intensity},{value:0},n.hold,e=>{t[i]=e.value})})}tiltHead(){if(!this.headBone)return;const e=this.headBone.rotation.z,t=Math.random()>.5?1:-1,i=a.EXPRESSIONS.headTilt;this._tween({z:e},{z:e+i.intensity*t},i.duration,e=>{this.headBone.rotation.z=e.z},()=>{setTimeout(()=>{this._tween({z:e+i.intensity*t},{z:e},i.duration,e=>{this.headBone.rotation.z=e.z})},i.hold)})}_tween(e,t,i,n,s){const o=Date.now(),a=Object.keys(t),r=()=>{const h=Date.now()-o,l=Math.min(h/i,1),c=l<.5?2*l*l:1-Math.pow(-2*l+2,2)/2;a.forEach(i=>{e[i]=e[i]+(t[i]-e[i])*c}),n(e),l<1?requestAnimationFrame(r):s&&s()};r()}destroy(){this.stopAll()}}class d{constructor(){this._events={}}on(e,t){return this._events[e]||(this._events[e]=[]),this._events[e].push(t),this}once(e,t){const i=(...n)=>{t(...n),this.off(e,i)};return this.on(e,i)}off(e,t){return this._events[e]?t?(this._events[e]=this._events[e].filter(e=>e!==t),this):(delete this._events[e],this):this}emit(e,...t){return this._events[e]?(this._events[e].forEach(e=>{e(...t)}),this):this}removeAllListeners(e){return e?delete this._events[e]:this._events={},this}}e.DEFAULT_CONFIG=a,e.DigitalHuman=class extends d{constructor(e={}){if(super(),this.config={container:e.container,modelUrl:e.modelUrl,useDefaultAnimations:!1!==e.useDefaultAnimations,animations:{idle:e.animations?.idle||null,talking:e.animations?.talking||null},backgroundColor:e.backgroundColor||"#1a1a2e",backgroundImage:e.backgroundImage||null,width:e.width||600,height:e.height||600,cameraPosition:e.cameraPosition||a.CAMERA.position,cameraTarget:e.cameraTarget||a.CAMERA.target,autoStart:e.autoStart||null,enableBlinking:!1!==e.enableBlinking,enableSmiling:!1!==e.enableSmiling,enableNodding:!1!==e.enableNodding,enableBrowRaising:!1!==e.enableBrowRaising,enableHeadTilting:!1!==e.enableHeadTilting,expressionFrequency:{...a.EXPRESSION_FREQUENCY,...e.expressionFrequency},onReady:e.onReady||null,onSpeakStart:e.onSpeakStart||null,onSpeakEnd:e.onSpeakEnd||null,onListenStart:e.onListenStart||null,onListenEnd:e.onListenEnd||null,onError:e.onError||null,showControls:e.showControls||!1,enableOrbitControls:!1!==e.enableOrbitControls,debug:e.debug||!1},!this.config.container)throw new Error("DigitalHuman: container is required");if(!this.config.modelUrl)throw new Error("DigitalHuman: modelUrl is required");this.isReady=!1,this.currentMode=null,this.isDestroyed=!1,this.sceneManager=null,this.animationController=null,this.lipSyncEngine=null,this.expressionManager=null,this.avatar=null,this.morphTargetMesh=null,this.headBone=null,this.neckBone=null,this._init()}async _init(){try{const e="string"==typeof this.config.container?document.querySelector(this.config.container):this.config.container;if(!e)throw new Error("Container not found");this.sceneManager=new r(e,{width:this.config.width,height:this.config.height,backgroundColor:this.config.backgroundColor,backgroundImage:this.config.backgroundImage,cameraPosition:this.config.cameraPosition,cameraTarget:this.config.cameraTarget,enableOrbitControls:this.config.enableOrbitControls}),await this._loadModel(),this.animationController=new h(this.avatar,this.sceneManager.mixer),this.sceneManager.mixer=this.animationController.mixer,this.lipSyncEngine=new l(this.morphTargetMesh),this.expressionManager=new c(this.morphTargetMesh,this.headBone,this.neckBone,this.config),await this._loadAnimations(),this.config.backgroundImage&&await this.setBackgroundImage(this.config.backgroundImage),this.isReady=!0,this.emit("ready"),this.config.onReady&&this.config.onReady(),"listening"===this.config.autoStart?this.startListening():"speaking"===this.config.autoStart&&console.warn('DigitalHuman: autoStart "speaking" requires audio, skipping'),this.config.debug&&console.log("‚úÖ DigitalHuman initialized")}catch(e){console.error("DigitalHuman initialization failed:",e),this.emit("error",e),this.config.onError&&this.config.onError(e)}}async _loadModel(){return new Promise((e,t)=>{(new i.GLTFLoader).load(this.config.modelUrl,i=>{if(this.avatar=i.scene,this.sceneManager.scene.add(this.avatar),this.avatar.traverse(e=>{if(e.isMesh&&e.morphTargetDictionary&&e.morphTargetInfluences&&(this.morphTargetMesh=e),e.isBone||"Bone"===e.type){const t=e.name.toLowerCase();t.includes("head")&&(this.headBone=e),t.includes("neck")&&(this.neckBone=e)}}),this.morphTargetMesh){if(this.headBone){const e=new o.Vector3(this.config.cameraPosition.x,this.config.cameraPosition.y,this.config.cameraPosition.z);this.headBone.lookAt(e)}e()}else t(new Error("Model does not have morph targets"))},void 0,t)})}async _loadAnimations(){const e={idle:this.config.animations.idle||(this.config.useDefaultAnimations?a.DEFAULT_ANIMATIONS.idle:null),talking:this.config.animations.talking||(this.config.useDefaultAnimations?a.DEFAULT_ANIMATIONS.talking:null)},t=[];e.idle&&t.push(this.animationController.loadAnimation("idle",e.idle)),e.talking&&t.push(this.animationController.loadAnimation("talking",e.talking)),await Promise.all(t)}startListening(){this.isReady?"listening"!==this.currentMode&&("speaking"===this.currentMode&&this.stopSpeaking(),this.currentMode="listening",this.animationController.play("idle"),this.expressionManager.startListeningMode(),this.emit("listenStart"),this.config.onListenStart&&this.config.onListenStart(),this.config.debug&&console.log("üëÇ Listening mode started")):console.warn("DigitalHuman: not ready yet")}stopListening(){"listening"===this.currentMode&&(this.currentMode=null,this.animationController.stop("idle"),this.expressionManager.stopListeningMode(),this.emit("listenEnd"),this.config.onListenEnd&&this.config.onListenEnd(),this.config.debug&&console.log("‚èπ Listening mode stopped"))}async speak(e){if(!this.isReady)return void console.warn("DigitalHuman: not ready yet");let t;if("listening"===this.currentMode&&this.stopListening(),this.currentMode="speaking",this.animationController.play("talking"),this.expressionManager.startSpeakingMode(),"string"==typeof e)t=new Audio(e);else if(e instanceof Blob)t=new Audio(URL.createObjectURL(e));else{if(!(e instanceof ArrayBuffer))throw new Error("Unsupported audio type");{const i=new Blob([e],{type:"audio/wav"});t=new Audio(URL.createObjectURL(i))}}t.crossOrigin="anonymous",t.addEventListener("play",()=>{this.lipSyncEngine.start(t),this.emit("speakStart",e),this.config.onSpeakStart&&this.config.onSpeakStart(e)}),t.addEventListener("ended",()=>{this.lipSyncEngine.stop(),this.emit("speakEnd"),this.config.onSpeakEnd&&this.config.onSpeakEnd()}),t.addEventListener("error",e=>{console.error("Audio playback error:",e),this.emit("error",e),this.config.onError&&this.config.onError(e)});try{await t.play(),this.config.debug&&console.log("üó£Ô∏è Speaking mode started")}catch(e){throw console.error("Audio play failed:",e),e}return t}stopSpeaking(){"speaking"===this.currentMode&&(this.currentMode=null,this.animationController.stop("talking"),this.lipSyncEngine.stop(),this.expressionManager.stopSpeakingMode(),this.config.debug&&console.log("‚èπ Speaking mode stopped"))}setBackgroundColor(e){this.sceneManager.setBackgroundColor(e)}async setBackgroundImage(e){await this.sceneManager.setBackgroundImage(e)}clearBackgroundImage(){this.sceneManager.clearBackgroundImage()}destroy(){this.isDestroyed||(this.stopListening(),this.stopSpeaking(),this.sceneManager&&this.sceneManager.destroy(),this.expressionManager&&this.expressionManager.destroy(),this.lipSyncEngine&&this.lipSyncEngine.destroy(),this.isDestroyed=!0,this.removeAllListeners(),this.config.debug&&console.log("üóëÔ∏è DigitalHuman destroyed"))}}});
